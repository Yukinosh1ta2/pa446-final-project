---
title: "Digital Divide in Illinois Counties"
author: "YOUR NAME"
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(tidyverse)
library(sf)
library(tmap)
library(plotly)
library(tidymodels)
library(rpart)
library(rpart.plot)
library(knitr)

# Assume this Rmd is in reports/, so go up one level to data/
il_geo <- readRDS("../data/processed/il_broadband_geo.rds")
il_df  <- read_csv("../data/processed/il_broadband.csv", show_col_types = FALSE)
```

# 1. Background and Research Questions

Access to reliable home internet has become a basic requirement for full participation in civic life. Residents use broadband connections to apply for jobs, complete schoolwork, access government services, and stay informed. When some places lag behind in internet access, that can deepen existing inequalities and limit opportunities for the people who live there.

This project focuses on **broadband access across counties in Illinois**. Using data from the American Community Survey (ACS), I examine how many households in each county report having broadband internet, how that access relates to income, and whether we can identify counties at risk of low broadband access using a decision tree model.

The report is organized around three main research questions:

1. How does broadband access vary across Illinois counties?  
2. How strongly is broadband access related to median household income at the county level?  
3. Can a decision tree (the machine learning method we studied in class) classify which counties have relatively low broadband access based on income?

# 2. Data and Methods

## 2.1 Data source

The data come from the **American Community Survey (ACS) 5-year estimates**, accessed through the Census API using the `tidycensus` R package in a separate script. For each county in Illinois, I used:

- Median household income (`B19013_001`)  
- Total number of households in the internet table (`B28002_001`)  
- Number of households with broadband of any type (`B28002_004`)  

From these fields, I created a variable for the **percentage of households with broadband**.

The original data, including geographic shapes for mapping, were saved as:

- `data/raw/il_broadband_raw.rds` (raw API pull)  
- `data/processed/il_broadband_geo.rds` (processed spatial data)  
- `data/processed/il_broadband.csv` (processed non-spatial data)  

This report reads the processed files so that the data acquisition and cleaning steps are reproducible but kept separate from the narrative report.

## 2.2 Key variables

```{r variables-summary}
il_df %>%
  select(county, med_income, hh_total, hh_broadband_any, pct_broadband_any) %>%
  slice_head(n = 10)
```

- `med_income`: Median household income in dollars.  
- `hh_total`: Total number of households in the internet table.  
- `hh_broadband_any`: Households with broadband of any type.  
- `pct_broadband_any`: Percentage of households with broadband (`100 * hh_broadband_any / hh_total`).

## 2.3 Basic descriptive statistics

```{r descriptives}
summary_stats <- il_df %>%
  summarise(
    n_counties           = n(),
    median_income_median = median(med_income, na.rm = TRUE),
    median_income_min    = min(med_income, na.rm = TRUE),
    median_income_max    = max(med_income, na.rm = TRUE),
    pct_bb_median        = median(pct_broadband_any, na.rm = TRUE),
    pct_bb_min           = min(pct_broadband_any, na.rm = TRUE),
    pct_bb_max           = max(pct_broadband_any, na.rm = TRUE)
  )

summary_stats
```

These summaries give a quick sense of the range of incomes and broadband access rates across counties before looking at spatial patterns.

# 3. Results

## 3.1 Broadband access by county (map, from figs folder)

```{r map-broadband-image, echo=FALSE, out.width="80%"}
include_graphics("../figs/map_broadband.png")
```

Darker colors represent counties with higher broadband access. The map highlights geographic disparities: some counties have a much smaller share of households with broadband compared to others.


## 3.2 Relationship between income and broadband access

### 3.2.1 Static scatterplot (from figs folder)

```{r scatter-income-broadband-image, echo=FALSE, out.width="80%"}
include_graphics("../figs/scatter_income_broadband.png")
```

It shows the overall pattern that counties with higher median household income tend to have higher percentages of households with broadband.

### 3.2.2 Interactive county table 

```{r interactive-table, warning=FALSE, message=FALSE}
library(DT)

il_df_table <- il_df %>%
  mutate(
    low_bb = if_else(
      pct_broadband_any < median(pct_broadband_any, na.rm = TRUE),
      "yes",
      "no"
    )
  ) %>%
  select(county, med_income, pct_broadband_any, low_bb)

datatable(
  il_df_table,
  options = list(pageLength = 10, autoWidth = TRUE),
  rownames = FALSE
)
```

This interactive table serves as the required interactive component. It uses the same processed data as the plots, but allows readers to explore individual counties in more detail by sorting and filtering.

## 3.3 Distribution of broadband access across counties

```{r hist-broadband-image, echo=FALSE, out.width="80%"}
include_graphics("../figs/hist_pct_broadband.png")
```

This histogram shows the distribution of county-level broadband access across Illinois. It helps illustrate whether most counties cluster at high access levels, low access levels, or somewhere in between, and whether there are outliers with especially low or high broadband access.

## 3.4 Advanced analysis (machine learning): decision tree classification

The goal is to see whether counties can be classified as having **low broadband access** or not, based on their median household income.

In the data, I create a binary target variable:

- `low_bb = "yes"` if a county's broadband percentage is below the median across all Illinois counties.  
- `low_bb = "no"` otherwise.

Using the `tidymodels` framework together with `rpart`, I fit a decision tree that predicts `low_bb` from median income.

```{r decision-tree-metrics}
median_pct <- median(il_df$pct_broadband_any, na.rm = TRUE)

il_ml <- il_df %>%
  mutate(
    low_bb = if_else(pct_broadband_any < median_pct, "yes", "no"),
    low_bb = factor(low_bb, levels = c("no", "yes"))
  ) %>%
  select(county, med_income, pct_broadband_any, low_bb) %>%
  drop_na()

set.seed(123)
split_obj <- initial_split(il_ml, prop = 0.8, strata = low_bb)
train_data <- training(split_obj)
test_data  <- testing(split_obj)

tree_spec <- decision_tree(
  tree_depth      = 4,
  cost_complexity = 0
) %>%
  set_engine("rpart") %>%
  set_mode("classification")

tree_fit <- workflow() %>%
  add_model(tree_spec) %>%
  add_formula(low_bb ~ med_income) %>%
  fit(data = train_data)

tree_preds <- predict(tree_fit, test_data, type = "class") %>%
  bind_cols(test_data)

metrics(tree_preds, truth = low_bb, estimate = .pred_class)
```

The table above reports evaluation metrics such as accuracy on a held-out test set. This helps show how well the tree is doing at distinguishing low-broadband counties from others based on income alone.

### 3.4.1 Decision tree visualization

Here I plot the fitted decision tree directly in the report so it can be read as a flowchart of rules.

```{r decision-tree-plot, fig.width=8, fig.height=5}
simple_tree <- tree_fit %>%
  extract_fit_parsnip() %>%
  pluck("fit")

rpart.plot(
  simple_tree,
  type          = 3,
  extra         = 104,
  fallen.leaves = TRUE,
  main          = "Decision Tree: Counties with Low Broadband Access"
)
```

Each box represents a node in the tree. Starting from the top, the tree asks a sequence of yes/no questions about median income (for example, whether income is below a certain dollar threshold). The leaves at the bottom show the predicted class (`low_bb = yes` or `no`) and the share of counties that fall into each leaf.


# 4. Interpretation and Policy Implications

Taken together, the map, scatterplots, histogram, and decision tree suggest that broadband access in Illinois is not uniform. Many counties appear to follow a pattern where higher median household income is associated with higher levels of broadband access, while some lower-income counties lag behind. The decision tree reinforces this by showing specific income thresholds where counties are especially likely to fall into the low-broadband group.

From a policy perspective, these results highlight the importance of targeted investments. Counties that fall into the “low income / low broadband” combination may need more support for infrastructure, subsidies for low-income households, or digital literacy programs. At the same time, counties that look strong on average may still contain neighborhoods or populations that are not well served, so local knowledge and more granular data are important.

When presenting these findings to decision-makers, it is important to frame them as evidence of structural differences—such as infrastructure, geography, and historical investment—rather than as shortcomings of individual residents or communities.

# 5. Ethics, Fairness, and Limitations

Several ethical and fairness issues arise in this kind of analysis:

- **Measurement limitations**: The ACS variables indicate whether households report having internet and broadband, but they do not capture speed, reliability, or affordability. A household might meet the technical definition of broadband but still struggle to use it effectively for school or work.
- **Sampling error**: The ACS is a survey with margins of error, especially for smaller counties. Treating these numbers as perfectly precise can misrepresent the uncertainty in the estimates.
- **Aggregation**: Analyzing data at the county level can hide differences within counties. A county with high overall broadband access might still include neighborhoods where many households lack reliable connections.
- **Risk of stigmatizing places**: Labeling some counties as “low access” risks reinforcing negative stereotypes. It is more constructive to treat these results as signals of where investment and support are most needed.
- **Missing context**: This analysis only includes income and broadband access. Other important factors—such as race, age, disability, or local governance—are not included, but they may shape digital inequality in important ways.

Being explicit about these limitations helps reduce the risk that the analysis will be misused or interpreted in ways that harm already disadvantaged communities.

# 6. Conclusion and Next Steps

This report used ACS data to explore the digital divide across Illinois counties. The main findings are:

- Broadband access varies significantly across counties.  
- County-level broadband access is positively associated with median household income.  
- A decision tree classifier (machine learning method from class) can identify income thresholds where counties are especially likely to have low broadband access.

For public agencies and nonprofits, these findings can help identify areas where additional investment or outreach may be needed. However, any policy response should combine this quantitative picture with local context, community engagement, and more detailed data.

Possible next steps include:

- Incorporating additional variables (such as educational attainment, urban/rural classification, or race/ethnicity) to refine the analysis.
- Analyzing more granular geographies, such as census tracts, when data and capacity allow.
- Collaborating with local organizations and residents to design solutions that address both infrastructure and affordability.

Overall, this analysis provides a starting point for understanding digital inequality in Illinois and for guiding more targeted efforts to close the broadband gap.
